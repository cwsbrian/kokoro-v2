# 오늘의 운세 카테고리 정의 (Product)

## 현재 상태

- **운세 탭**: [app/(tabs)/fortune.tsx](app/(tabs)/fortune.tsx) — "Coming soon" 플레이스홀더만 존재
- **사용자 성향 데이터**: [constants/kisho-results.ts](constants/kisho-results.ts) — Kisho 16유형(트레이트, 키워드, 설명)으로 AI 입력 예정
- **계획**: 매일 아침 성향 → AI → 오늘의 운세 수신 → 앱 표시 + 알림

## 카테고리 선정 기준

1. **한국/동양 운세에서 통용되는 구분** 반영 (총운, 재물, 애정, 직업, 건강, 대인관계 등)
2. **오늘 한 화면**에 모두 보여주기 때문에 **6~8개** 수준 유지 (과하면 스크롤/피로, 적으면 정보 부족)
3. **알림/한 줄 문구**로 자연스럽게 쓸 수 있는 주제만 포함

---

## 제안 카테고리 (8개)

| ID               | 이름         | 설명                      | 알림/문구 예시                             |
| ---------------- | ---------- | ----------------------- | ------------------------------------ |
| **total**        | 총운         | 오늘의 전체 기운, 하루 요약        | "오늘은 설레는 누군가를 만날 수도 있는 날이에요."        |
| **love**         | 연애·애정운     | 연애, 썸, 고백, 만남           | "오늘은 마음을 열기 좋은 날이에요."                |
| **money**        | 금전·재물운     | 소비, 저축, 투자, 수입          | "오늘은 큰 지출은 미루는 게 좋아요."               |
| **work**         | 직업·일운      | 업무, 협업, 승진, 이직          | "오늘은 중요한 결정은 내일로 미뤄보세요."             |
| **health**       | 건강운        | 컨디션, 주의할 점              | "오늘은 물을 조심하세요." / "충분히 쉬는 날로 삼아보세요." |
| **relationship** | 대인관계운      | 친구, 가족, 주변인             | "오늘은 오래된 친구에게 연락해보세요."               |
| **luck**         | 행운         | 행운의 색·숫자·방향·시간대 (부가 정보) | "행운의 색: 민트 / 숫자: 7"                  |
| **caution**      | 주의·금기 (선택) | 피하면 좋은 행동, 금기           | "오늘은 약속 취소는 피하는 게 좋아요."              |

- **total**은 항상 포함해 "오늘 한 줄 요약"으로 사용.
- **luck**는 짧은 부가 정보(색·숫자·방향 등)로, 알림보다는 앱 내 "오늘의 운세" 상세에서 표시하기에 적합.
- **caution**은 서비스 톤에 따라 포함/제외 가능 (경고형 문구가 부담스러우면 생략).

---

## 카테고리 개수 옵션

- **풀 버전 (8개)**: total, love, money, work, health, relationship, luck, caution — 앱 상세 화면용.
- **알림용 핵심 (3~4개)**: total + (love | money | work | health 중 1~2개) 조합으로 "오늘 한 줄 + 한 가지 주제"만 푸시.
- **미니멀 (5~6개)**: luck·caution 제외 — total, love, money, work, health, relationship.

---

## 데이터/타입 제안

- **Category ID**: `total` | `love` | `money` | `work` | `health` | `relationship` | `luck` | `caution`
- **오늘의 운세 응답 구조 (AI)**
  - `total: string` (필수, 한 줄)
  - 나머지 카테고리별 `{ summary: string, detail?: string }`
  - `luck?: { color?: string, number?: string, direction?: string }`
- **알림**: `total` 문구를 기본으로, 필요 시 한 카테고리(예: love, health) 문구를 붙여 "오늘의 운세: [total] · [love]" 형태 사용.

---

## AI 프롬프트 및 JSON 응답

### 1. AI에게 보낼 입력 데이터

- **오늘 날짜**: `YYYY-MM-DD` (또는 "오늘" 문구) — 오늘의 운세 기준일
- **사용자 성향 (Kisho 기반)**  
  앱의 [AnalysisResult](types/index.ts) + [KISHO_RESULTS](constants/kisho-results.ts)에서 아래만 추려서 전달:
  - `kishoType`: `kisho.fullType` (예: `"Inner-Harmony-Feeling-Flow"`)
  - `label`: Kisho 유형 라벨 (예: `"조화로운 내향인"`)
  - `description`: 유형 설명 (1~2문장)
  - `traits`: 특징 배열 (예: `["깊은 관계 형성", "유연한 환경 선호", ...]`)
  - `keywords`: 키워드 배열 (예: `["조화", "감성", "유연", "관계", "내향"]`)

선택: Big Five 수치·MBTI 코드가 있으면 "성향 요약" 한 줄을 추가해도 됨. 1차는 Kisho만으로도 가능.

---

### 2. 프롬프트 구조

**System (역할 고정)**

```
당신은 사용자의 성향을 반영한 "오늘의 운세"를 생성하는 전문가입니다.
- 반드시 JSON만 출력하고, 다른 설명이나 마크다운은 넣지 마세요.
- 문구는 친근하고 위로가 되는 톤으로, 한 문장은 1~2줄 이내로 짧게 써주세요.
- 사용자의 Kisho 유형(특징·키워드)을 참고해, 그 사람에게 맞는 조언처럼 작성해주세요.
```

**User (매일 요청 시)**

```
오늘 날짜: {todayYYYYMMDD}
사용자 성향:
- Kisho 유형: {label} ({kishoType})
- 설명: {description}
- 특징: {traits.join(", ")}
- 키워드: {keywords.join(", ")}

위 성향을 반영해서 "오늘의 운세"를 아래 JSON 형식으로만 생성해주세요.
```

---

### 3. JSON 응답 스키마 (AI가 채워서 반환할 구조)

**필수 규칙**

- `total`: 필수. 오늘의 총운 한 줄 (알림·메인 문구용).
- `love`, `money`, `work`, `health`, `relationship`: 각각 `summary` 필수. 알림/카드용 한 줄.
- `luck`: 행운 정보 객체. `color`, `number`, `direction` 등 선택.
- `caution`: 선택. 있으면 한 줄로.

**TypeScript 타입**

```ts
export type FortuneCategoryId =
  | 'total' | 'love' | 'money' | 'work' | 'health' | 'relationship' | 'luck' | 'caution'

export interface TodayFortuneLuck {
  color?: string      // 예: "민트", "파스텔 블루"
  number?: number     // 예: 7
  direction?: string  // 예: "동쪽"
  time?: string       // 예: "오전 9시~11시" (선택)
}

export interface TodayFortuneResponse {
  total: string
  love: { summary: string; detail?: string }
  money: { summary: string; detail?: string }
  work: { summary: string; detail?: string }
  health: { summary: string; detail?: string }
  relationship: { summary: string; detail?: string }
  luck?: TodayFortuneLuck
  caution?: string
}
```

**JSON 예시 (AI 응답 본문)**

```json
{
  "total": "오늘은 설레는 누군가를 만날 수도 있는 날이에요.",
  "love": {
    "summary": "오늘은 마음을 열기 좋은 날이에요.",
    "detail": "조용한 만남보다는 소소한 대화가 인연을 돕습니다."
  },
  "money": {
    "summary": "오늘은 큰 지출은 미루는 게 좋아요.",
    "detail": "필요한 것만 구매하는 날로 삼으면 좋습니다."
  },
  "work": {
    "summary": "오늘은 중요한 결정은 내일로 미뤄보세요.",
    "detail": null
  },
  "health": {
    "summary": "오늘은 물을 조심하세요.",
    "detail": "손 씻기, 음료 온도 체크를 꼭 해주세요."
  },
  "relationship": {
    "summary": "오늘은 오래된 친구에게 연락해보세요.",
    "detail": null
  },
  "luck": {
    "color": "민트",
    "number": 7,
    "direction": "동쪽"
  },
  "caution": "오늘은 약속 취소는 피하는 게 좋아요."
}
```

---

### 4. API 호출 시 유의사항

- **응답 형식**: OpenAI 사용 시 `response_format: { type: "json_object" }` 지정해 JSON만 받기.
- **파싱**: 응답 텍스트를 `JSON.parse()` 한 뒤 `TodayFortuneResponse`로 검증(또는 Zod 등 스키마 검증).
- **실패 시**: total만 fallback 문구로 채우거나, "오늘의 운세를 불러오지 못했어요. 잠시 후 다시 시도해주세요." 등 처리.

---

## 다음 단계 (구현 시)

1. `constants/fortune-categories.ts` 등에 위 ID·이름·설명·아이콘 정의
2. **AI 호출**: 위 System/User 프롬프트로 요청, `response_format: { type: "json_object" }` 사용, 응답을 `TodayFortuneResponse` 타입으로 파싱·검증
3. 운세 탭 UI: 카드/섹션별로 total → love, money, work, health, relationship → luck, caution 순 표시
4. 알림: total + (선택 1개) 조합으로 메시지 생성

이렇게 정의하면 "어떤 카테고리가 있을지"와 "AI에 어떤 prompt로 요청하고 어떤 JSON을 받을지"가 정리되어, 구현 시 그대로 사용할 수 있습니다.
